# CEE Document Validation System
## Product Specification & Technical Architecture

**Version:** 1.0  
**Date:** November 2025  
**Prepared for:** Valoren.org  
**Target Accuracy:** 98.9%

---

## Executive Summary

This document outlines a comprehensive AI-powered system for automating CEE (Certificats d'Ã‰conomies d'Ã‰nergie) document validation. The system is designed to be **operation-agnostic**, allowing users to configure validation rules for any current or future CEE operation codes (BAR-TH-xxx, BAT-TH-xxx, IND-UT-xxx, etc.) through a flexible rule engine.

### Key Design Principles

1. **Abstraction Over Specificity**: The system does not hardcode rules for specific CEE operations. Instead, it provides a configurable rule engine where users define validation logic.

2. **Human-in-the-Loop**: AI provides suggestions and extractions; humans validate and correct. This feedback loop continuously improves accuracy.

3. **Modular Pipeline**: Each processing stage (OCR, classification, extraction, validation) is independent and replaceable.

4. **Audit Trail**: Every decision, extraction, and validation is logged for compliance and dispute resolution.

---

## Part 1: System Overview

### 1.1 Core Workflow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           CEE VALIDATION WORKFLOW                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Document â”‚â”€â”€â”€â–¶â”‚ Classificationâ”‚â”€â”€â”€â–¶â”‚  Extraction â”‚â”€â”€â”€â–¶â”‚   Rule-Based  â”‚  â”‚
â”‚  â”‚  Upload  â”‚    â”‚   (AI/VLM)   â”‚    â”‚  (OCR/VLM)  â”‚    â”‚  Validation   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚       â”‚
â”‚                                                                     â–¼       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Billing  â”‚â—€â”€â”€â”€â”‚   Approved   â”‚â—€â”€â”€â”€â”‚   Human     â”‚â—€â”€â”€â”€â”‚  Validation   â”‚  â”‚
â”‚  â”‚  Call    â”‚    â”‚   Dossier    â”‚    â”‚  Review UI  â”‚    â”‚   Results     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 Document Types Supported

| Document Type | French Name | Description | Multi-Page |
|--------------|-------------|-------------|------------|
| Quote | Devis | Initial quote with CEE prime deduction | Yes (2-5 pages) |
| Invoice | Facture | Final invoice after work completion | Yes (2-3 pages) |
| Sworn Statement | Attestation sur l'Honneur (AH) | Official CEE form with sections A, B, C, R1 | Yes (4-6 pages) |
| Contribution Framework | Cadre de Contribution (CDC) | Prime agreement document | Yes (1-2 pages) |
| Tax Notice | Avis d'ImpÃ´t | Income verification for precarity status | Yes (2-4 pages) |
| Photos | Photos Avant/AprÃ¨s | Before/after installation photos | Multiple images |
| Sizing Note | Note de Dimensionnement | Technical sizing calculations | Yes (1-3 pages) |
| Partnership Contract | Contrat de Partenariat | Installer-Mandataire agreement | Yes (10-25 pages) |

### 1.3 CEE Operation Categories

The system supports ALL CEE operation codes through configuration, including:

**Residential (BAR):**
- BAR-EN-xxx: Envelope/Insulation operations
- BAR-TH-xxx: Thermal equipment operations
- BAR-EQ-xxx: Equipment operations
- BAR-SE-xxx: Service operations

**Tertiary (BAT):**
- BAT-EN-xxx: Envelope/Insulation operations
- BAT-TH-xxx: Thermal equipment operations (including BAT-TH-116 GTB)
- BAT-EQ-xxx: Equipment operations

**Industrial (IND):**
- IND-UT-xxx: Utility operations (including IND-UT-116)
- IND-BA-xxx: Building operations
- IND-EN-xxx: Envelope operations

---

## Part 2: System Architecture

### 2.1 High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              FRONTEND LAYER                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Installer  â”‚ â”‚  Validator  â”‚ â”‚    Admin    â”‚ â”‚   Rule Config       â”‚   â”‚
â”‚  â”‚   Portal    â”‚ â”‚     UI      â”‚ â”‚   Console   â”‚ â”‚      Studio         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                               API GATEWAY                                    â”‚
â”‚              (Authentication, Rate Limiting, Request Routing)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           MICROSERVICES LAYER                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Document   â”‚ â”‚  Extraction  â”‚ â”‚  Validation  â”‚ â”‚     Billing      â”‚   â”‚
â”‚  â”‚   Service    â”‚ â”‚   Service    â”‚ â”‚   Service    â”‚ â”‚     Service      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚     User     â”‚ â”‚    Rule      â”‚ â”‚   Dossier    â”‚ â”‚   Notification   â”‚   â”‚
â”‚  â”‚   Service    â”‚ â”‚   Engine     â”‚ â”‚   Service    â”‚ â”‚     Service      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                             AI/ML PIPELINE                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Document   â”‚ â”‚     OCR      â”‚ â”‚    Field     â”‚ â”‚    Signature     â”‚   â”‚
â”‚  â”‚Classificationâ”‚ â”‚   Engine     â”‚ â”‚  Extraction  â”‚ â”‚    Detection     â”‚   â”‚
â”‚  â”‚    Model     â”‚ â”‚  (Docling)   â”‚ â”‚    Model     â”‚ â”‚      Model       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              DATA LAYER                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  PostgreSQL  â”‚ â”‚    Redis     â”‚ â”‚   S3/MinIO   â”‚ â”‚  Elasticsearch   â”‚   â”‚
â”‚  â”‚  (Metadata)  â”‚ â”‚   (Cache)    â”‚ â”‚  (Documents) â”‚ â”‚    (Search)      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 AI/ML Pipeline Detail

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DOCUMENT PROCESSING PIPELINE                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  STAGE 1: INGESTION                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â€¢ File upload (PDF, JPG, PNG, TIFF)                                 â”‚   â”‚
â”‚  â”‚ â€¢ File validation (size, format, corruption check)                  â”‚   â”‚
â”‚  â”‚ â€¢ Page splitting for multi-page documents                           â”‚   â”‚
â”‚  â”‚ â€¢ Image preprocessing (deskew, denoise, contrast enhancement)       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚                                      â”‚
â”‚                                      â–¼                                      â”‚
â”‚  STAGE 2: DOCUMENT UNDERSTANDING (VLM/OCR)                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Primary: Docling (IBM) - Layout analysis + text extraction          â”‚   â”‚
â”‚  â”‚ Secondary: Granite-Docling - Complex layouts, tables                â”‚   â”‚
â”‚  â”‚ Fallback: Mistral OCR / PaddleOCR - Scanned documents              â”‚   â”‚
â”‚  â”‚ Output: Structured DoclingDocument with bounding boxes              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚                                      â”‚
â”‚                                      â–¼                                      â”‚
â”‚  STAGE 3: DOCUMENT CLASSIFICATION                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â€¢ Multi-label classification (document type + page type)            â”‚   â”‚
â”‚  â”‚ â€¢ Confidence scoring (threshold: 0.85 for auto-accept)              â”‚   â”‚
â”‚  â”‚ â€¢ Page grouping for multi-page documents                            â”‚   â”‚
â”‚  â”‚ â€¢ Unknown document type flagging for human review                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚                                      â”‚
â”‚                                      â–¼                                      â”‚
â”‚  STAGE 4: FIELD EXTRACTION                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â€¢ Schema-driven extraction based on document type                   â”‚   â”‚
â”‚  â”‚ â€¢ Named Entity Recognition (names, addresses, SIRET, dates)         â”‚   â”‚
â”‚  â”‚ â€¢ Table extraction (line items, amounts)                            â”‚   â”‚
â”‚  â”‚ â€¢ Handwriting detection (signatures, "Bon pour accord")             â”‚   â”‚
â”‚  â”‚ â€¢ Checkbox detection (for AH form sections)                         â”‚   â”‚
â”‚  â”‚ â€¢ Confidence scoring per field                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚                                      â”‚
â”‚                                      â–¼                                      â”‚
â”‚  STAGE 5: CROSS-DOCUMENT VALIDATION                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â€¢ Field consistency across documents (names, addresses, amounts)    â”‚   â”‚
â”‚  â”‚ â€¢ Date logic validation (engagement < intervention < facture)       â”‚   â”‚
â”‚  â”‚ â€¢ Signature consistency check (visual similarity scoring)           â”‚   â”‚
â”‚  â”‚ â€¢ CEE operation code matching                                       â”‚   â”‚
â”‚  â”‚ â€¢ Prime amount verification                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚                                      â”‚
â”‚                                      â–¼                                      â”‚
â”‚  STAGE 6: RULE ENGINE VALIDATION                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â€¢ Execute configurable validation rules                             â”‚   â”‚
â”‚  â”‚ â€¢ Generate validation report (passed/failed/warning)                â”‚   â”‚
â”‚  â”‚ â€¢ Flag issues for human review                                      â”‚   â”‚
â”‚  â”‚ â€¢ Calculate confidence score for entire dossier                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Part 3: Screen-by-Screen UI Specification

### Screen 1: Dashboard

**Purpose:** Central hub showing system status, pending work, and KPIs

**URL:** `/dashboard`

**Components:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HEADER                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ [Logo] CEE Validation System    [Search...]    [Notifications] [User]â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  KPI CARDS ROW                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Pending   â”‚ â”‚   Today    â”‚ â”‚  Accuracy  â”‚ â”‚   Avg.     â”‚ â”‚  Errors  â”‚ â”‚
â”‚  â”‚  Review    â”‚ â”‚  Processed â”‚ â”‚   Rate     â”‚ â”‚  Time      â”‚ â”‚  Flagged â”‚ â”‚
â”‚  â”‚    47      â”‚ â”‚    156     â”‚ â”‚   98.7%    â”‚ â”‚   4.2min   â”‚ â”‚    12    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  MAIN CONTENT AREA                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  DOSSIERS BY STATUS            â”‚ â”‚  RECENT ACTIVITY                â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ â— New (23)              â”‚   â”‚ â”‚  â”‚ 10:42 Dossier #4521     â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ â—‹ Processing (12)       â”‚   â”‚ â”‚  â”‚       approved by Marie â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ â—‹ Awaiting Review (47)  â”‚   â”‚ â”‚  â”‚ 10:38 Dossier #4520     â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ â—‹ Approved (1,245)      â”‚   â”‚ â”‚  â”‚       flagged: signatureâ”‚   â”‚   â”‚
â”‚  â”‚  â”‚ â—‹ Rejected (34)         â”‚   â”‚ â”‚  â”‚ 10:35 New upload from   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ â—‹ Billing Pending (89)  â”‚   â”‚ â”‚  â”‚       Label Energie     â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  DOSSIERS REQUIRING ATTENTION                                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ ID    â”‚ Installer   â”‚ Operation    â”‚ Issue      â”‚ Priority    â”‚ â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚   â”‚
â”‚  â”‚  â”‚ #4520 â”‚ Label Energ â”‚ BAR-TH-171   â”‚ Signature  â”‚ â— High      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ #4518 â”‚ MHG Energie â”‚ BAR-TH-113   â”‚ Date mism. â”‚ â— High      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ #4515 â”‚ EcoRÃ©nov    â”‚ BAT-TH-116   â”‚ Missing AH â”‚ â—‹ Medium    â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Component Details:**

| Component | Type | Data Source | Interactions |
|-----------|------|-------------|--------------|
| KPI Cards | StatCard | Real-time API | Click to filter dossiers |
| Status Donut | Chart | Aggregated counts | Click segment to filter |
| Recent Activity | Feed | WebSocket stream | Click to open dossier |
| Attention Table | DataTable | Prioritized query | Sort, filter, click to open |

---

### Screen 2: Operation Configuration

**Purpose:** Define and manage CEE operation types and their document requirements

**URL:** `/admin/operations`

**Components:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OPERATION CONFIGURATION                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  [+ New Operation]    [Import from Template]    [Export]             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  OPERATION LIST                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Search: [________________]  Filter: [All Sectors â–¼]  [Active â–¼]    â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚  BAR-TH-171                                              [Edit]â”‚   â”‚
â”‚  â”‚  â”‚  Pompe Ã  chaleur air/eau                                       â”‚   â”‚
â”‚  â”‚  â”‚  Documents: Devis, Facture, AH, CDC, Avis d'impÃ´t             â”‚   â”‚
â”‚  â”‚  â”‚  Rules: 24 active | Last updated: 2025-11-15                  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚  BAR-TH-113                                              [Edit]â”‚   â”‚
â”‚  â”‚  â”‚  ChaudiÃ¨re biomasse individuelle                              â”‚   â”‚
â”‚  â”‚  â”‚  Documents: Devis, Facture, AH, CDC, Avis d'impÃ´t, Photos    â”‚   â”‚
â”‚  â”‚  â”‚  Rules: 28 active | Last updated: 2025-11-10                  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚  BAT-TH-116                                              [Edit]â”‚   â”‚
â”‚  â”‚  â”‚  SystÃ¨me GTB pour le tertiaire                                â”‚   â”‚
â”‚  â”‚  â”‚  Documents: Devis, Facture, AH, Note dimensionnement          â”‚   â”‚
â”‚  â”‚  â”‚  Rules: 18 active | Last updated: 2025-11-08                  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  OPERATION EDITOR (when editing)                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Operation Code: [BAR-TH-171    ]                                   â”‚   â”‚
â”‚  â”‚  Name: [Pompe Ã  chaleur de type air/eau                        ]   â”‚   â”‚
â”‚  â”‚  Sector: [RÃ©sidentiel â–¼]                                           â”‚   â”‚
â”‚  â”‚  Fiche Version: [A46.3 â–¼]                                          â”‚   â”‚
â”‚  â”‚  Valid From: [2024-01-01]  Valid Until: [________]                 â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  REQUIRED DOCUMENTS                                                 â”‚   â”‚
â”‚  â”‚  â˜‘ Devis (Quote)                                                   â”‚   â”‚
â”‚  â”‚  â˜‘ Facture (Invoice)                                               â”‚   â”‚
â”‚  â”‚  â˜‘ Attestation sur l'Honneur                                       â”‚   â”‚
â”‚  â”‚  â˜‘ Cadre de Contribution                                           â”‚   â”‚
â”‚  â”‚  â˜‘ Avis d'ImpÃ´t (if precarity)                                     â”‚   â”‚
â”‚  â”‚  â˜ Note de Dimensionnement                                         â”‚   â”‚
â”‚  â”‚  â˜‘ Photos Avant/AprÃ¨s                                              â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  [Save] [Cancel] [Clone] [Archive]                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Screen 3: Rule Engine Configuration

**Purpose:** Create and manage validation rules that apply across operations

**URL:** `/admin/rules`

**Components:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RULE ENGINE CONFIGURATION                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  TABS: [All Rules] [Date Rules] [Amount Rules] [Cross-Doc] [Custom]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  [+ Create Rule]  [Import Rules]  [Test Rules]                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  RULE LIST                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚  RULE: DATE_001 - Engagement Before Intervention        [ON]  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Category: Date Logic | Severity: ERROR | Auto-reject: Yes   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Applies to: ALL operations                                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  CONDITION:                                                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  devis.date_signature <= facture.date_debut_travaux          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  ERROR MESSAGE:                                               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  "La date d'engagement (signature devis) doit Ãªtre           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   antÃ©rieure Ã  la date de dÃ©but des travaux"                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  [Edit] [Test] [Disable] [Clone]                             â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚  RULE: DATE_002 - Two Week Minimum Period             [ON]    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Category: Date Logic | Severity: WARNING | Auto-reject: No  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Applies to: Coup de Pouce operations                        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  CONDITION:                                                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  (facture.date_debut_travaux - devis.date_signature) >= 14   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  WARNING MESSAGE:                                             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  "DÃ©lai infÃ©rieur Ã  14 jours entre engagement et travaux"    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  [Edit] [Test] [Disable] [Clone]                             â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚  RULE: AMOUNT_001 - Prime Consistency                  [ON]   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Category: Amount | Severity: ERROR | Auto-reject: Yes       â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Applies to: ALL operations                                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  CONDITION:                                                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  devis.prime_cee == cdc.prime_cee == facture.prime_cee       â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  ERROR MESSAGE:                                               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  "Le montant de la prime CEE diffÃ¨re entre les documents"    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  [Edit] [Test] [Disable] [Clone]                             â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚  RULE: CROSS_001 - Beneficiary Name Consistency        [ON]   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Category: Cross-Document | Severity: ERROR | Auto-reject: Noâ”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Applies to: ALL operations                                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  CONDITION:                                                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  similarity(devis.beneficiaire_nom, ah.beneficiaire_nom,     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚             facture.beneficiaire_nom) >= 0.95                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  ERROR MESSAGE:                                               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  "Le nom du bÃ©nÃ©ficiaire n'est pas cohÃ©rent entre documents" â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  [Edit] [Test] [Disable] [Clone]                             â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  RULE EDITOR (when creating/editing)                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Rule ID: [CUSTOM_001      ]  Name: [My Custom Rule            ]   â”‚   â”‚
â”‚  â”‚  Category: [Custom â–¼]         Severity: [ERROR â–¼]                  â”‚   â”‚
â”‚  â”‚  Auto-reject on failure: [Yes â–¼]                                   â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  APPLIES TO:                                                        â”‚   â”‚
â”‚  â”‚  â—‹ All operations                                                  â”‚   â”‚
â”‚  â”‚  â—‹ Specific operations: [Select operations...]                     â”‚   â”‚
â”‚  â”‚  â—‹ Operations matching: [Coup de Pouce â–¼]                          â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  CONDITION BUILDER:                                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚  IF [devis.surface_chauffee â–¼] [!= â–¼] [ah.surface_chauffee]â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  [+ Add Condition] [+ Add OR Group]                         â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  OR WRITE CUSTOM EXPRESSION:                                        â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚  abs(devis.surface_chauffee - ah.surface_chauffee) <= 5     â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  ERROR MESSAGE:                                                     â”‚   â”‚
â”‚  â”‚  [La surface chauffÃ©e dÃ©clarÃ©e est incohÃ©rente                 ]   â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  [Test with Sample Data] [Save Draft] [Save & Activate]            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Rule Expression Language:**

```javascript
// Available document references
devis.*           // Quote fields
facture.*         // Invoice fields
ah.*              // Attestation sur l'Honneur fields
cdc.*             // Cadre de Contribution fields
avis_impot.*      // Tax notice fields
photos.*          // Photo metadata

// Available functions
similarity(str1, str2)           // Returns 0.0-1.0 string similarity
date_diff(date1, date2, unit)    // Returns difference in days/months/years
exists(field)                     // Returns true if field is present
is_empty(field)                   // Returns true if field is empty
matches(field, regex)             // Regex matching
in_list(value, [list])           // Check if value in list
calculate_kwh_cumac(...)         // CEE-specific calculations

// Operators
==, !=, <, >, <=, >=             // Comparison
&&, ||, !                         // Logical
+, -, *, /                        // Arithmetic
```

---

### Screen 4: Document Upload (Installer Portal)

**Purpose:** Allow installers to upload dossier documents

**URL:** `/upload`

**Components:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DOCUMENT UPLOAD - New Dossier                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  STEP 1: SELECT OPERATION                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Operation Code: [Search or select... â–¼]                            â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  Selected: BAR-TH-171 - Pompe Ã  chaleur air/eau                    â”‚   â”‚
â”‚  â”‚  Required documents:                                                â”‚   â”‚
â”‚  â”‚  â˜ Devis signÃ©                                                     â”‚   â”‚
â”‚  â”‚  â˜ Facture                                                         â”‚   â”‚
â”‚  â”‚  â˜ Attestation sur l'Honneur (4 pages)                             â”‚   â”‚
â”‚  â”‚  â˜ Cadre de Contribution                                           â”‚   â”‚
â”‚  â”‚  â˜ Avis d'impÃ´t (si prÃ©caritÃ©)                                     â”‚   â”‚
â”‚  â”‚  â˜ Photos avant/aprÃ¨s                                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  STEP 2: UPLOAD DOCUMENTS                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚                                                               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚           â”‚     ğŸ“                          â”‚                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚           â”‚                                 â”‚                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚           â”‚   Drag & drop files here        â”‚                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚           â”‚   or click to browse            â”‚                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚           â”‚                                 â”‚                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚           â”‚   PDF, JPG, PNG (max 20MB each) â”‚                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                               â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  UPLOADED FILES:                                                    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ ğŸ“„ devis_BADJI_2024.pdf          â”‚ Detecting... â³        â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ ğŸ“„ facture_MHG_4521.pdf          â”‚ Facture âœ“              â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ ğŸ“„ AH_pages_1-4.pdf              â”‚ Attestation sur l'H. âœ“ â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ ğŸ“„ CDC_BADJI.pdf                 â”‚ Cadre Contribution âœ“   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ ğŸ–¼ï¸ photo_avant.jpg               â”‚ Photo Avant âœ“          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ ğŸ–¼ï¸ photo_apres.jpg               â”‚ Photo AprÃ¨s âœ“          â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  âš ï¸ Missing: Avis d'impÃ´t (required for precarity verification)    â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  STEP 3: BENEFICIARY INFORMATION (Optional - AI will extract)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Nom: [____________________]  PrÃ©nom: [____________________]       â”‚   â”‚
â”‚  â”‚  Adresse travaux: [____________________________________________]   â”‚   â”‚
â”‚  â”‚  Code postal: [______]  Ville: [_______________________________]   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  [Cancel]                                          [Submit for Processing]  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Screen 5: Human Validation UI

**Purpose:** Allow validators to review AI extractions and approve/reject dossiers

**URL:** `/validation/{dossier_id}`

**Components:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DOSSIER VALIDATION - #4521                                    [â† Back]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  HEADER INFO                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Beneficiary: BADJI Mehenna                                         â”‚   â”‚
â”‚  â”‚  Address: 10 RUE DES TERRES ROUGES, 77680 ROISSY EN BRIE           â”‚   â”‚
â”‚  â”‚  Operation: BAR-TH-171 (Pompe Ã  chaleur air/eau)                   â”‚   â”‚
â”‚  â”‚  Installer: MHG ENERGIES | Prime: 4,000.00 â‚¬                       â”‚   â”‚
â”‚  â”‚  Status: âš ï¸ Awaiting Review | Confidence: 87%                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  DOCUMENT TABS                                                              â”‚
â”‚  [Devis âœ“] [Facture âœ“] [AH âš ï¸] [CDC âœ“] [Photos âœ“] [Summary]               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  DOCUMENT VIEWER               â”‚  EXTRACTED FIELDS                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚  â”‚                          â”‚ â”‚  â”‚ DEVIS FIELDS                   â”‚â”‚   â”‚
â”‚  â”‚  â”‚                          â”‚ â”‚  â”‚                                â”‚â”‚   â”‚
â”‚  â”‚  â”‚    [Document Preview]    â”‚ â”‚  â”‚ NumÃ©ro devis:                  â”‚â”‚   â”‚
â”‚  â”‚  â”‚    with highlighted      â”‚ â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚   â”‚
â”‚  â”‚  â”‚    extraction regions    â”‚ â”‚  â”‚ â”‚ 2024-BADJI-171     âœ“ 98% â”‚  â”‚â”‚   â”‚
â”‚  â”‚  â”‚                          â”‚ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚   â”‚
â”‚  â”‚  â”‚                          â”‚ â”‚  â”‚                                â”‚â”‚   â”‚
â”‚  â”‚  â”‚   ğŸ” Click field to      â”‚ â”‚  â”‚ Date devis:                    â”‚â”‚   â”‚
â”‚  â”‚  â”‚   highlight in document  â”‚ â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚   â”‚
â”‚  â”‚  â”‚                          â”‚ â”‚  â”‚ â”‚ 18/10/2024         âœ“ 99% â”‚  â”‚â”‚   â”‚
â”‚  â”‚  â”‚                          â”‚ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚   â”‚
â”‚  â”‚  â”‚                          â”‚ â”‚  â”‚                                â”‚â”‚   â”‚
â”‚  â”‚  â”‚                          â”‚ â”‚  â”‚ BÃ©nÃ©ficiaire nom:              â”‚â”‚   â”‚
â”‚  â”‚  â”‚                          â”‚ â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚   â”‚
â”‚  â”‚  â”‚                          â”‚ â”‚  â”‚ â”‚ BADJI Mehenna      âœ“ 97% â”‚  â”‚â”‚   â”‚
â”‚  â”‚  â”‚                          â”‚ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚   â”‚
â”‚  â”‚  â”‚                          â”‚ â”‚  â”‚                                â”‚â”‚   â”‚
â”‚  â”‚  â”‚                          â”‚ â”‚  â”‚ Prime CEE:                     â”‚â”‚   â”‚
â”‚  â”‚  â”‚                          â”‚ â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚   â”‚
â”‚  â”‚  â”‚                          â”‚ â”‚  â”‚ â”‚ 4,000.00 â‚¬         âœ“ 99% â”‚  â”‚â”‚   â”‚
â”‚  â”‚  â”‚                          â”‚ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚   â”‚
â”‚  â”‚  â”‚                          â”‚ â”‚  â”‚                                â”‚â”‚   â”‚
â”‚  â”‚  â”‚                          â”‚ â”‚  â”‚ Signature prÃ©sente:            â”‚â”‚   â”‚
â”‚  â”‚  â”‚                          â”‚ â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚   â”‚
â”‚  â”‚  â”‚                          â”‚ â”‚  â”‚ â”‚ âœ“ Oui              âœ“ 95% â”‚  â”‚â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚   â”‚
â”‚  â”‚                                â”‚  â”‚                                â”‚â”‚   â”‚
â”‚  â”‚  [â—€ Prev Page] Page 1/2       â”‚  â”‚ "Bon pour accord":             â”‚â”‚   â”‚
â”‚  â”‚               [Next Page â–¶]   â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚   â”‚
â”‚  â”‚                                â”‚  â”‚ â”‚ âœ“ PrÃ©sent          âœ“ 92% â”‚  â”‚â”‚   â”‚
â”‚  â”‚  Zoom: [100% â–¼] [Fit] [Full]  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚                                      â”‚                                    â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  VALIDATION RESULTS                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  âœ“ PASSED (18)                                                      â”‚   â”‚
â”‚  â”‚    â€¢ Date engagement antÃ©rieure aux travaux                         â”‚   â”‚
â”‚  â”‚    â€¢ Prime CEE cohÃ©rente sur tous les documents                     â”‚   â”‚
â”‚  â”‚    â€¢ Adresse travaux identique                                      â”‚   â”‚
â”‚  â”‚    â€¢ ... [Show all]                                                 â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  âš ï¸ WARNINGS (2)                                                    â”‚   â”‚
â”‚  â”‚    â€¢ DÃ©lai entre engagement et travaux < 14 jours (12 jours)       â”‚   â”‚
â”‚  â”‚    â€¢ Signature AH partie B lÃ©gÃ¨rement diffÃ©rente du devis          â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  âœ— ERRORS (0)                                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  VALIDATION ACTIONS                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Comment: [Add validation note...                               ]   â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  [Request Documents]  [Reject with Reason]  [âœ“ Approve Dossier]    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Key Features:**

1. **Document Viewer**
   - Pan and zoom capabilities
   - Highlight extraction regions on click
   - Side-by-side multi-document comparison
   - Page navigation for multi-page documents

2. **Field Editor**
   - Inline editing with change tracking
   - Confidence score display
   - Source highlight linking
   - Correction feedback for model improvement

3. **Validation Results**
   - Grouped by severity (Error, Warning, Passed)
   - Clickable to see rule details
   - Override capability with reason logging

---

### Screen 6: Field Extraction Schema Editor

**Purpose:** Define the fields to extract for each document type

**URL:** `/admin/schemas/{document_type}`

**Components:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FIELD SCHEMA EDITOR - Devis (Quote)                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Document Type: [Devis â–¼]    Version: [2.3]    [Save] [Test] [Export]      â”‚
â”‚                                                                             â”‚
â”‚  FIELD DEFINITIONS                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚  Field: numero_devis                                     [â–¼]  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Display Name: NumÃ©ro de devis                                â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Data Type: [String â–¼]    Required: [Yes â–¼]                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Validation: ^[A-Z0-9\-]+$                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Extraction Hints: "Devis nÂ°", "NumÃ©ro", "RÃ©fÃ©rence"         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Cross-reference: facture.reference_devis                     â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚  Field: date_devis                                       [â–¼]  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Display Name: Date du devis                                  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Data Type: [Date â–¼]       Required: [Yes â–¼]                  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Format: DD/MM/YYYY                                           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Extraction Hints: "Date :", "Le", "Fait le"                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Validation: Must be â‰¤ today                                  â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚  Field: beneficiaire_nom                                 [â–¼]  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Display Name: Nom du bÃ©nÃ©ficiaire                            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Data Type: [String â–¼]    Required: [Yes â–¼]                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Extraction Hints: "M.", "Mme", "Client", "BÃ©nÃ©ficiaire"     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Post-processing: UPPERCASE, trim                             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Cross-reference: ah.beneficiaire_nom, facture.client_nom     â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚  Field: prime_cee                                        [â–¼]  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Display Name: Prime CEE                                      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Data Type: [Currency â–¼]  Required: [Yes â–¼]                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Extraction Hints: "Prime CEE", "Coup de pouce", "Prime"     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Validation: > 0                                              â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Cross-reference: cdc.prime_montant, facture.prime_cee        â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚  Field: signature_present                                [â–¼]  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Display Name: Signature prÃ©sente                             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Data Type: [Boolean â–¼]   Required: [Yes â–¼]                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Detection: Handwriting detection model                       â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Confidence threshold: 0.90                                   â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  [+ Add Field]                                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Screen 7: Billing & Payment Summary

**Purpose:** Generate billing summary after dossier approval

**URL:** `/billing/{dossier_id}`

**Components:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BILLING SUMMARY - Dossier #4521                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  DOSSIER INFORMATION                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Beneficiary: BADJI Mehenna                                         â”‚   â”‚
â”‚  â”‚  Operation: BAR-TH-171 - Pompe Ã  chaleur air/eau                   â”‚   â”‚
â”‚  â”‚  Installer: MHG ENERGIES (SIRET: 433 005 482)                      â”‚   â”‚
â”‚  â”‚  Validation Date: 27/11/2025 14:32                                 â”‚   â”‚
â”‚  â”‚  Validated By: Marie DUPONT                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  CEE CALCULATION                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  Operation Code:           BAR-TH-171                               â”‚   â”‚
â”‚  â”‚  Zone climatique:          H1                                       â”‚   â”‚
â”‚  â”‚  Surface chauffÃ©e:         120 mÂ²                                   â”‚   â”‚
â”‚  â”‚  Type logement:            Maison individuelle                      â”‚   â”‚
â”‚  â”‚  Ã‰nergie remplacÃ©e:        Fioul                                    â”‚   â”‚
â”‚  â”‚  PrÃ©caritÃ©:                Modeste                                  â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚
â”‚  â”‚  kWh cumac calculÃ©s:       42,800 kWh cumac                        â”‚   â”‚
â”‚  â”‚  Prix unitaire:            0.00935 â‚¬/kWh cumac                     â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚
â”‚  â”‚  PRIME CEE TOTALE:         4,000.00 â‚¬                              â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  PAYMENT BREAKDOWN (per contract terms)                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  90% on validation:        3,600.00 â‚¬                              â”‚   â”‚
â”‚  â”‚  10% on EMMY delivery:       400.00 â‚¬                              â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  Payment terms:            15 days from invoice                     â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  BILLING CALL SCRIPT                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ“ Call to: MHG ENERGIES                                          â”‚   â”‚
â”‚  â”‚  Contact: Jean-Pierre MARTIN                                        â”‚   â”‚
â”‚  â”‚  Phone: 01 85 74 10 99                                             â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  Key Points:                                                        â”‚   â”‚
â”‚  â”‚  â€¢ Dossier #4521 has been approved                                 â”‚   â”‚
â”‚  â”‚  â€¢ Prime amount: 4,000.00 â‚¬                                        â”‚   â”‚
â”‚  â”‚  â€¢ Payment schedule: 90% now, 10% after EMMY                       â”‚   â”‚
â”‚  â”‚  â€¢ Invoice reference to use: VALOREN-2025-4521                     â”‚   â”‚
â”‚  â”‚  â€¢ Expected payment date: 12/12/2025                               â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  [ğŸ“‹ Copy Script] [ğŸ“§ Send Email Summary] [ğŸ“ Log Call]            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  [Generate Invoice PDF]  [Send to Installer]  [Mark as Billed]             â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Part 4: Data Models

### 4.1 Core Entities

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              DATA MODEL                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤

DOSSIER
â”œâ”€â”€ id: UUID
â”œâ”€â”€ reference: String (e.g., "VAL-2025-4521")
â”œâ”€â”€ status: Enum (NEW, PROCESSING, AWAITING_REVIEW, APPROVED, REJECTED, BILLED)
â”œâ”€â”€ operation_code: String (FK -> Operation)
â”œâ”€â”€ installer_id: UUID (FK -> Installer)
â”œâ”€â”€ beneficiary: JSON {
â”‚   â”œâ”€â”€ nom: String
â”‚   â”œâ”€â”€ prenom: String
â”‚   â”œâ”€â”€ adresse: String
â”‚   â”œâ”€â”€ code_postal: String
â”‚   â”œâ”€â”€ ville: String
â”‚   â”œâ”€â”€ email: String
â”‚   â”œâ”€â”€ telephone: String
â”‚   â””â”€â”€ precarite: Enum (CLASSIQUE, MODESTE, TRES_MODESTE)
â”‚   }
â”œâ”€â”€ travaux_adresse: JSON { ... }
â”œâ”€â”€ prime_cee: Decimal
â”œâ”€â”€ kwh_cumac: Integer
â”œâ”€â”€ confidence_score: Float
â”œâ”€â”€ created_at: DateTime
â”œâ”€â”€ updated_at: DateTime
â”œâ”€â”€ validated_at: DateTime
â”œâ”€â”€ validated_by: UUID (FK -> User)
â””â”€â”€ documents: [Document]

DOCUMENT
â”œâ”€â”€ id: UUID
â”œâ”€â”€ dossier_id: UUID (FK -> Dossier)
â”œâ”€â”€ type: Enum (DEVIS, FACTURE, AH, CDC, AVIS_IMPOT, PHOTO_AVANT, PHOTO_APRES, ...)
â”œâ”€â”€ original_filename: String
â”œâ”€â”€ storage_path: String
â”œâ”€â”€ page_count: Integer
â”œâ”€â”€ file_size: Integer
â”œâ”€â”€ mime_type: String
â”œâ”€â”€ classification_confidence: Float
â”œâ”€â”€ processing_status: Enum (PENDING, PROCESSING, COMPLETED, FAILED)
â”œâ”€â”€ extracted_fields: JSON { field_name: { value, confidence, bounding_box } }
â”œâ”€â”€ ocr_text: Text
â”œâ”€â”€ created_at: DateTime
â””â”€â”€ pages: [DocumentPage]

DOCUMENT_PAGE
â”œâ”€â”€ id: UUID
â”œâ”€â”€ document_id: UUID (FK -> Document)
â”œâ”€â”€ page_number: Integer
â”œâ”€â”€ image_path: String
â”œâ”€â”€ ocr_text: Text
â”œâ”€â”€ layout_analysis: JSON
â””â”€â”€ extracted_regions: JSON

OPERATION
â”œâ”€â”€ id: UUID
â”œâ”€â”€ code: String (e.g., "BAR-TH-171")
â”œâ”€â”€ name: String
â”œâ”€â”€ sector: Enum (RESIDENTIAL, TERTIARY, INDUSTRIAL, AGRICULTURAL, TRANSPORT)
â”œâ”€â”€ fiche_version: String
â”œâ”€â”€ valid_from: Date
â”œâ”€â”€ valid_until: Date (nullable)
â”œâ”€â”€ required_documents: [String]
â”œâ”€â”€ field_schema: JSON
â”œâ”€â”€ is_coup_de_pouce: Boolean
â”œâ”€â”€ is_active: Boolean
â””â”€â”€ created_at: DateTime

VALIDATION_RULE
â”œâ”€â”€ id: UUID
â”œâ”€â”€ code: String (e.g., "DATE_001")
â”œâ”€â”€ name: String
â”œâ”€â”€ category: Enum (DATE, AMOUNT, CROSS_DOC, SIGNATURE, CUSTOM)
â”œâ”€â”€ severity: Enum (ERROR, WARNING, INFO)
â”œâ”€â”€ auto_reject: Boolean
â”œâ”€â”€ condition_expression: Text
â”œâ”€â”€ error_message_template: String
â”œâ”€â”€ applies_to_operations: [String] or "*"
â”œâ”€â”€ is_active: Boolean
â”œâ”€â”€ created_at: DateTime
â””â”€â”€ updated_at: DateTime

VALIDATION_RESULT
â”œâ”€â”€ id: UUID
â”œâ”€â”€ dossier_id: UUID (FK -> Dossier)
â”œâ”€â”€ rule_id: UUID (FK -> ValidationRule)
â”œâ”€â”€ status: Enum (PASSED, FAILED, WARNING)
â”œâ”€â”€ details: JSON
â”œâ”€â”€ override_by: UUID (FK -> User, nullable)
â”œâ”€â”€ override_reason: Text (nullable)
â””â”€â”€ created_at: DateTime

INSTALLER
â”œâ”€â”€ id: UUID
â”œâ”€â”€ raison_sociale: String
â”œâ”€â”€ siret: String
â”œâ”€â”€ siren: String
â”œâ”€â”€ adresse: String
â”œâ”€â”€ contact_nom: String
â”œâ”€â”€ contact_email: String
â”œâ”€â”€ contact_telephone: String
â”œâ”€â”€ rge_number: String
â”œâ”€â”€ rge_valid_until: Date
â”œâ”€â”€ contract_id: UUID (FK -> Contract)
â”œâ”€â”€ is_active: Boolean
â””â”€â”€ created_at: DateTime

CONTRACT (Partnership Agreement)
â”œâ”€â”€ id: UUID
â”œâ”€â”€ reference: String
â”œâ”€â”€ installer_id: UUID (FK -> Installer)
â”œâ”€â”€ obligÃ©: String
â”œâ”€â”€ volume_gwh_cumac: Decimal
â”œâ”€â”€ prix_classique: Decimal
â”œâ”€â”€ prix_precaire: Decimal
â”œâ”€â”€ payment_terms: JSON
â”œâ”€â”€ valid_from: Date
â”œâ”€â”€ valid_until: Date
â”œâ”€â”€ document_path: String
â””â”€â”€ created_at: DateTime

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 Field Schema Example (Devis)

```json
{
  "document_type": "DEVIS",
  "version": "2.3",
  "fields": [
    {
      "name": "numero_devis",
      "display_name": "NumÃ©ro de devis",
      "data_type": "string",
      "required": true,
      "validation": "^[A-Z0-9\\-\\/]+$",
      "extraction_hints": ["Devis nÂ°", "NumÃ©ro", "RÃ©fÃ©rence", "NÂ°"],
      "cross_references": ["facture.reference_devis", "ah.reference_devis"]
    },
    {
      "name": "date_devis",
      "display_name": "Date du devis",
      "data_type": "date",
      "required": true,
      "format": "DD/MM/YYYY",
      "extraction_hints": ["Date :", "Le", "Fait le", "En date du"],
      "validation": "value <= today()"
    },
    {
      "name": "date_visite_prealable",
      "display_name": "Date de visite prÃ©alable",
      "data_type": "date",
      "required": true,
      "format": "DD/MM/YYYY",
      "extraction_hints": ["Visite prÃ©alable", "Visite technique", "Date de visite"],
      "validation": "value <= date_devis"
    },
    {
      "name": "beneficiaire_civilite",
      "display_name": "CivilitÃ©",
      "data_type": "enum",
      "required": false,
      "allowed_values": ["M.", "Mme", "M. et Mme"],
      "extraction_hints": ["M.", "Mme", "Monsieur", "Madame"]
    },
    {
      "name": "beneficiaire_nom",
      "display_name": "Nom du bÃ©nÃ©ficiaire",
      "data_type": "string",
      "required": true,
      "post_processing": ["uppercase", "trim"],
      "extraction_hints": ["Client", "BÃ©nÃ©ficiaire", "Nom"],
      "cross_references": ["facture.client_nom", "ah.beneficiaire_nom", "cdc.beneficiaire_nom"]
    },
    {
      "name": "beneficiaire_prenom",
      "display_name": "PrÃ©nom du bÃ©nÃ©ficiaire",
      "data_type": "string",
      "required": true,
      "post_processing": ["capitalize", "trim"],
      "extraction_hints": ["PrÃ©nom"],
      "cross_references": ["facture.client_prenom", "ah.beneficiaire_prenom"]
    },
    {
      "name": "adresse_travaux",
      "display_name": "Adresse des travaux",
      "data_type": "address",
      "required": true,
      "extraction_hints": ["Adresse travaux", "Adresse du chantier", "Lieu d'intervention"],
      "cross_references": ["facture.adresse_travaux", "ah.adresse_travaux"]
    },
    {
      "name": "code_postal",
      "display_name": "Code postal",
      "data_type": "string",
      "required": true,
      "validation": "^[0-9]{5}$",
      "extraction_hints": ["Code postal", "CP"]
    },
    {
      "name": "ville",
      "display_name": "Ville",
      "data_type": "string",
      "required": true,
      "post_processing": ["uppercase", "trim"]
    },
    {
      "name": "email_beneficiaire",
      "display_name": "Email du bÃ©nÃ©ficiaire",
      "data_type": "email",
      "required": false,
      "extraction_hints": ["E-mail", "Email", "Mail", "Courriel"]
    },
    {
      "name": "telephone_beneficiaire",
      "display_name": "TÃ©lÃ©phone du bÃ©nÃ©ficiaire",
      "data_type": "phone",
      "required": false,
      "extraction_hints": ["TÃ©l", "TÃ©lÃ©phone", "Tel", "Mobile"]
    },
    {
      "name": "operation_cee_code",
      "display_name": "Code opÃ©ration CEE",
      "data_type": "string",
      "required": true,
      "validation": "^(BAR|BAT|IND|AGR|TRA|RES)-[A-Z]{2}-[0-9]{3}$",
      "extraction_hints": ["BAR-TH-", "BAT-TH-", "Fiche CEE", "OpÃ©ration"]
    },
    {
      "name": "description_operation",
      "display_name": "Description de l'opÃ©ration",
      "data_type": "text",
      "required": true,
      "extraction_hints": ["Installation", "Mise en place", "Pose"]
    },
    {
      "name": "marque_equipement",
      "display_name": "Marque de l'Ã©quipement",
      "data_type": "string",
      "required": true,
      "extraction_hints": ["Marque", "Fabricant"]
    },
    {
      "name": "modele_equipement",
      "display_name": "ModÃ¨le de l'Ã©quipement",
      "data_type": "string",
      "required": true,
      "extraction_hints": ["ModÃ¨le", "RÃ©fÃ©rence", "Type"]
    },
    {
      "name": "puissance_kw",
      "display_name": "Puissance (kW)",
      "data_type": "decimal",
      "required": false,
      "extraction_hints": ["kW", "Puissance nominale", "Puissance thermique"]
    },
    {
      "name": "etas_percent",
      "display_name": "ETAS (%)",
      "data_type": "decimal",
      "required": false,
      "extraction_hints": ["ETAS", "EfficacitÃ© saisonniÃ¨re", "rendement"]
    },
    {
      "name": "surface_chauffee",
      "display_name": "Surface chauffÃ©e (mÂ²)",
      "data_type": "decimal",
      "required": true,
      "extraction_hints": ["Surface chauffÃ©e", "mÂ²", "surface habitable"]
    },
    {
      "name": "zone_climatique",
      "display_name": "Zone climatique",
      "data_type": "enum",
      "required": true,
      "allowed_values": ["H1", "H2", "H3"],
      "extraction_hints": ["Zone", "H1", "H2", "H3"]
    },
    {
      "name": "type_logement",
      "display_name": "Type de logement",
      "data_type": "enum",
      "required": true,
      "allowed_values": ["Maison individuelle", "Appartement"],
      "extraction_hints": ["Maison", "Appartement", "Type de logement"]
    },
    {
      "name": "energie_chauffage_existant",
      "display_name": "Ã‰nergie de chauffage existante",
      "data_type": "enum",
      "required": true,
      "allowed_values": ["Ã‰lectrique", "Gaz", "Fioul", "Bois", "Charbon", "GPL"],
      "extraction_hints": ["chauffage existant", "Ã©nergie actuelle", "remplacement"]
    },
    {
      "name": "kwh_cumac",
      "display_name": "kWh cumac",
      "data_type": "integer",
      "required": false,
      "extraction_hints": ["kWh cumac", "Cumac"]
    },
    {
      "name": "prime_cee",
      "display_name": "Prime CEE (â‚¬)",
      "data_type": "currency",
      "required": true,
      "extraction_hints": ["Prime CEE", "Prime Coup de pouce", "Prime Ã©nergie"],
      "cross_references": ["cdc.prime_montant", "facture.prime_cee"]
    },
    {
      "name": "montant_ttc",
      "display_name": "Montant TTC (â‚¬)",
      "data_type": "currency",
      "required": true,
      "extraction_hints": ["Total TTC", "Montant TTC", "TTC"]
    },
    {
      "name": "reste_a_payer",
      "display_name": "Reste Ã  payer (â‚¬)",
      "data_type": "currency",
      "required": true,
      "extraction_hints": ["Reste Ã  payer", "Net Ã  payer", "Ã€ payer"]
    },
    {
      "name": "mention_bon_pour_accord",
      "display_name": "Mention 'Bon pour accord'",
      "data_type": "boolean",
      "required": true,
      "detection_type": "handwriting",
      "extraction_hints": ["Bon pour accord", "Lu et approuvÃ©"]
    },
    {
      "name": "date_signature",
      "display_name": "Date de signature",
      "data_type": "date",
      "required": true,
      "detection_type": "handwriting",
      "extraction_hints": ["Date", "Le", "Fait le"]
    },
    {
      "name": "signature_present",
      "display_name": "Signature prÃ©sente",
      "data_type": "boolean",
      "required": true,
      "detection_type": "signature",
      "confidence_threshold": 0.90
    },
    {
      "name": "signature_image",
      "display_name": "Image de la signature",
      "data_type": "image_region",
      "required": false,
      "cross_references": ["ah.signature_cadre_b", "cdc.signature_beneficiaire"]
    },
    {
      "name": "installateur_raison_sociale",
      "display_name": "Raison sociale installateur",
      "data_type": "string",
      "required": true,
      "extraction_hints": ["SARL", "SAS", "EURL", "Entreprise"]
    },
    {
      "name": "installateur_siret",
      "display_name": "SIRET installateur",
      "data_type": "string",
      "required": true,
      "validation": "^[0-9]{14}$",
      "extraction_hints": ["SIRET", "NÂ° SIRET"]
    },
    {
      "name": "installateur_rge",
      "display_name": "NumÃ©ro RGE",
      "data_type": "string",
      "required": true,
      "extraction_hints": ["RGE", "Qualibat", "Qualit'EnR", "QB/"]
    },
    {
      "name": "mention_gestion_dechets",
      "display_name": "Mention gestion des dÃ©chets",
      "data_type": "boolean",
      "required": true,
      "extraction_hints": ["dÃ©chets", "Ã©vacuation", "traitement"]
    },
    {
      "name": "mediateur",
      "display_name": "MÃ©diateur mentionnÃ©",
      "data_type": "boolean",
      "required": true,
      "extraction_hints": ["mÃ©diateur", "mÃ©diation", "litige"]
    }
  ]
}
```

---

## Part 5: AI/ML Pipeline Implementation

### 5.1 Technology Stack

| Component | Primary Technology | Alternatives |
|-----------|-------------------|--------------|
| **Document Parsing** | Docling (IBM) | PyMuPDF, pdf2image |
| **OCR Engine** | Granite-Docling | Mistral OCR, PaddleOCR, Tesseract |
| **VLM (Vision-Language)** | Qwen2-VL-7B | Gemini2.5, Qwen3 vl 8b |
| **Layout Analysis** | Docling Heron Model | LayoutLMv3, DiT |
| **Table Extraction** | TableFormer (Docling) | TATR, TableTransformer |
| **NER** | GLiNER / spaCy | Flair, Stanza |
| **Handwriting Detection** | Custom CNN + Transformer | Azure Form Recognizer |
| **Text Embedding** | OpenAI embeddings |
| **Vector Store** | Typesense |
| **Orchestration** | LlamaIndex | Motia |
| **Task Queue** | Celery + Redis | RQ, Dramatiq |
| **Backend** | FastAPI | Django REST, Flask |
| **Frontend** | Next.js + React | Vue.js, Angular |
| **Database** | PostgreSQL |
| **Object Storage** | MinIO (S3-compatible) | AWS S3, GCS |
| **Search** |Typesense |
| **Monitoring** | Prometheus + Grafana | DataDog, New Relic |

### 5.2 Pipeline Architecture Code Structure

```
cee-validation-system/
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ main.py                    # FastAPI app entry
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ dossiers.py           # Dossier CRUD endpoints
â”‚   â”‚   â”œâ”€â”€ documents.py          # Document upload/processing
â”‚   â”‚   â”œâ”€â”€ validation.py         # Validation endpoints
â”‚   â”‚   â”œâ”€â”€ rules.py              # Rule management
â”‚   â”‚   â”œâ”€â”€ operations.py         # Operation configuration
â”‚   â”‚   â””â”€â”€ billing.py            # Billing endpoints
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ dossier.py
â”‚   â”‚   â”œâ”€â”€ document.py
â”‚   â”‚   â”œâ”€â”€ validation.py
â”‚   â”‚   â””â”€â”€ user.py
â”‚   â””â”€â”€ schemas/
â”‚       â”œâ”€â”€ dossier.py            # Pydantic schemas
â”‚       â””â”€â”€ document.py
â”‚
â”œâ”€â”€ pipeline/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ orchestrator.py           # Main pipeline coordinator
â”‚   â”œâ”€â”€ ingestion/
â”‚   â”‚   â”œâ”€â”€ file_handler.py       # File upload handling
â”‚   â”‚   â”œâ”€â”€ preprocessor.py       # Image preprocessing
â”‚   â”‚   â””â”€â”€ page_splitter.py      # Multi-page document splitting
â”‚   â”‚
â”‚   â”œâ”€â”€ ocr/
â”‚   â”‚   â”œâ”€â”€ docling_engine.py     # Docling integration
â”‚   â”‚   â”œâ”€â”€ mistral_ocr.py        # Mistral OCR fallback
â”‚   â”‚   â”œâ”€â”€ paddle_ocr.py         # PaddleOCR fallback
â”‚   â”‚   â””â”€â”€ ocr_factory.py        # OCR engine selector
â”‚   â”‚
â”‚   â”œâ”€â”€ classification/
â”‚   â”‚   â”œâ”€â”€ document_classifier.py # Document type classification
â”‚   â”‚   â”œâ”€â”€ page_classifier.py     # Page type within document
â”‚   â”‚   â””â”€â”€ models/
â”‚   â”‚       â””â”€â”€ classifier_v1.pt   # Trained classification model
â”‚   â”‚
â”‚   â”œâ”€â”€ extraction/
â”‚   â”‚   â”œâ”€â”€ field_extractor.py     # Schema-driven extraction
â”‚   â”‚   â”œâ”€â”€ entity_recognizer.py   # NER for names, dates, amounts
â”‚   â”‚   â”œâ”€â”€ table_extractor.py     # Table structure extraction
â”‚   â”‚   â”œâ”€â”€ signature_detector.py  # Signature detection
â”‚   â”‚   â”œâ”€â”€ handwriting_detector.py # Handwritten text detection
â”‚   â”‚   â””â”€â”€ schemas/
â”‚   â”‚       â”œâ”€â”€ devis.json
â”‚   â”‚       â”œâ”€â”€ facture.json
â”‚   â”‚       â”œâ”€â”€ ah.json
â”‚   â”‚       â””â”€â”€ cdc.json
â”‚   â”‚
â”‚   â”œâ”€â”€ validation/
â”‚   â”‚   â”œâ”€â”€ rule_engine.py         # Rule evaluation engine
â”‚   â”‚   â”œâ”€â”€ cross_doc_validator.py # Cross-document consistency
â”‚   â”‚   â”œâ”€â”€ date_validator.py      # Date logic validation
â”‚   â”‚   â”œâ”€â”€ amount_validator.py    # Amount validation
â”‚   â”‚   â””â”€â”€ signature_validator.py # Signature consistency
â”‚   â”‚
â”‚   â””â”€â”€ post_processing/
â”‚       â”œâ”€â”€ confidence_scorer.py   # Overall confidence calculation
â”‚       â”œâ”€â”€ result_aggregator.py   # Combine all validation results
â”‚       â””â”€â”€ report_generator.py    # Generate validation report
â”‚
â”œâ”€â”€ rule_engine/
â”‚   â”œâ”€â”€ parser.py                  # Rule expression parser
â”‚   â”œâ”€â”€ evaluator.py               # Rule condition evaluator
â”‚   â”œâ”€â”€ functions.py               # Built-in functions (similarity, date_diff, etc.)
â”‚   â””â”€â”€ context.py                 # Execution context with document data
â”‚
â”œâ”€â”€ workers/
â”‚   â”œâ”€â”€ celery_app.py              # Celery configuration
â”‚   â”œâ”€â”€ tasks/
â”‚   â”‚   â”œâ”€â”€ process_document.py    # Document processing task
â”‚   â”‚   â”œâ”€â”€ run_validation.py      # Validation task
â”‚   â”‚   â””â”€â”€ generate_billing.py    # Billing generation task
â”‚   â””â”€â”€ callbacks.py               # Task completion callbacks
â”‚
â”œâ”€â”€ ml_models/
â”‚   â”œâ”€â”€ training/
â”‚   â”‚   â”œâ”€â”€ train_classifier.py    # Document classifier training
â”‚   â”‚   â”œâ”€â”€ train_extractor.py     # Field extractor fine-tuning
â”‚   â”‚   â””â”€â”€ train_signature.py     # Signature model training
â”‚   â”œâ”€â”€ inference/
â”‚   â”‚   â”œâ”€â”€ classifier_inference.py
â”‚   â”‚   â””â”€â”€ extractor_inference.py
â”‚   â””â”€â”€ data/
â”‚       â”œâ”€â”€ training_samples/      # Annotated training data
â”‚       â””â”€â”€ evaluation/            # Test datasets
â”‚
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ validation/[id].tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ upload.tsx
â”‚   â”‚   â”‚   â””â”€â”€ admin/
â”‚   â”‚   â”‚       â”œâ”€â”€ rules.tsx
â”‚   â”‚   â”‚       â””â”€â”€ operations.tsx
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ DocumentViewer.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ FieldEditor.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ValidationResults.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ RuleBuilder.tsx
â”‚   â”‚   â”‚   â””â”€â”€ BillingCard.tsx
â”‚   â”‚   â””â”€â”€ hooks/
â”‚   â”‚       â””â”€â”€ useDocumentExtraction.ts
â”‚   â””â”€â”€ public/
â”‚
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ settings.py                # Application settings
â”‚   â”œâ”€â”€ operations/                # Operation configurations
â”‚   â”‚   â”œâ”€â”€ bar_th_171.yaml
â”‚   â”‚   â”œâ”€â”€ bar_th_113.yaml
â”‚   â”‚   â””â”€â”€ bat_th_116.yaml
â”‚   â””â”€â”€ rules/                     # Default rule definitions
â”‚       â”œâ”€â”€ date_rules.yaml
â”‚       â”œâ”€â”€ amount_rules.yaml
â”‚       â””â”€â”€ cross_doc_rules.yaml
â”‚
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ seed_operations.py         # Seed CEE operations
â”‚   â”œâ”€â”€ seed_rules.py              # Seed default rules
â”‚   â””â”€â”€ migrate_data.py            # Data migration scripts
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ integration/
â”‚   â””â”€â”€ fixtures/
â”‚       â””â”€â”€ sample_documents/      # Test documents
â”‚
â”œâ”€â”€ docker/
â”‚   â”œâ”€â”€ Dockerfile.api
â”‚   â”œâ”€â”€ Dockerfile.worker
â”‚   â””â”€â”€ docker-compose.yml
â”‚
â””â”€â”€ README.md
```

### 5.3 Core Pipeline Implementation

```python
# pipeline/orchestrator.py

from typing import Dict, List, Optional
from dataclasses import dataclass
from enum import Enum
import asyncio

from pipeline.ingestion import FileHandler, Preprocessor, PageSplitter
from pipeline.ocr import OCRFactory
from pipeline.classification import DocumentClassifier, PageClassifier
from pipeline.extraction import FieldExtractor, SignatureDetector
from pipeline.validation import RuleEngine, CrossDocValidator


class ProcessingStatus(Enum):
    PENDING = "pending"
    INGESTING = "ingesting"
    CLASSIFYING = "classifying"
    EXTRACTING = "extracting"
    VALIDATING = "validating"
    COMPLETED = "completed"
    FAILED = "failed"


@dataclass
class ProcessingResult:
    status: ProcessingStatus
    document_type: Optional[str]
    extracted_fields: Dict
    confidence_scores: Dict
    validation_results: List[Dict]
    errors: List[str]


class DocumentPipelineOrchestrator:
    """
    Main orchestrator for the document processing pipeline.
    Coordinates all stages from ingestion to validation.
    """
    
    def __init__(self, config: Dict):
        self.config = config
        
        # Initialize pipeline components
        self.file_handler = FileHandler()
        self.preprocessor = Preprocessor()
        self.page_splitter = PageSplitter()
        self.ocr_factory = OCRFactory()
        self.document_classifier = DocumentClassifier()
        self.page_classifier = PageClassifier()
        self.field_extractor = FieldExtractor()
        self.signature_detector = SignatureDetector()
        self.rule_engine = RuleEngine()
        self.cross_doc_validator = CrossDocValidator()
    
    async def process_document(
        self,
        file_path: str,
        operation_code: str,
        hints: Optional[Dict] = None
    ) -> ProcessingResult:
        """
        Process a single document through the entire pipeline.
        
        Args:
            file_path: Path to the uploaded document
            operation_code: CEE operation code (e.g., "BAR-TH-171")
            hints: Optional hints for extraction (e.g., expected document type)
        
        Returns:
            ProcessingResult with all extracted data and validation results
        """
        errors = []
        
        try:
            # Stage 1: Ingestion
            raw_document = await self._ingest_document(file_path)
            
            # Stage 2: Preprocessing
            processed_pages = await self._preprocess_document(raw_document)
            
            # Stage 3: OCR
            ocr_results = await self._run_ocr(processed_pages)
            
            # Stage 4: Classification
            doc_type, classification_confidence = await self._classify_document(
                ocr_results, 
                hints
            )
            
            # Stage 5: Field Extraction
            extracted_fields, extraction_confidence = await self._extract_fields(
                ocr_results,
                doc_type,
                operation_code
            )
            
            # Stage 6: Signature Detection
            signature_data = await self._detect_signatures(processed_pages)
            extracted_fields.update(signature_data)
            
            return ProcessingResult(
                status=ProcessingStatus.COMPLETED,
                document_type=doc_type,
                extracted_fields=extracted_fields,
                confidence_scores={
                    "classification": classification_confidence,
                    "extraction": extraction_confidence,
                    "overall": self._calculate_overall_confidence(
                        classification_confidence,
                        extraction_confidence
                    )
                },
                validation_results=[],  # Populated during dossier validation
                errors=errors
            )
            
        except Exception as e:
            return ProcessingResult(
                status=ProcessingStatus.FAILED,
                document_type=None,
                extracted_fields={},
                confidence_scores={},
                validation_results=[],
                errors=[str(e)]
            )
    
    async def validate_dossier(
        self,
        dossier_id: str,
        documents: List[Dict],
        operation_code: str
    ) -> Dict:
        """
        Validate an entire dossier with all its documents.
        
        Args:
            dossier_id: Unique dossier identifier
            documents: List of processed documents with extracted fields
            operation_code: CEE operation code
        
        Returns:
            Validation results including passed/failed rules and warnings
        """
        # Build context with all document data
        context = self._build_validation_context(documents)
        
        # Get applicable rules for this operation
        rules = await self.rule_engine.get_rules_for_operation(operation_code)
        
        # Execute rule validation
        rule_results = await self.rule_engine.evaluate_rules(rules, context)
        
        # Run cross-document validation
        cross_doc_results = await self.cross_doc_validator.validate(
            documents,
            operation_code
        )
        
        # Aggregate results
        all_results = rule_results + cross_doc_results
        
        return {
            "dossier_id": dossier_id,
            "passed": [r for r in all_results if r["status"] == "passed"],
            "warnings": [r for r in all_results if r["status"] == "warning"],
            "errors": [r for r in all_results if r["status"] == "error"],
            "overall_status": self._determine_overall_status(all_results),
            "confidence_score": self._calculate_dossier_confidence(
                documents,
                all_results
            )
        }
    
    async def _ingest_document(self, file_path: str) -> Dict:
        """Handle file ingestion and initial validation."""
        return await self.file_handler.process(file_path)
    
    async def _preprocess_document(self, raw_document: Dict) -> List[Dict]:
        """Preprocess and split document into pages."""
        preprocessed = await self.preprocessor.process(raw_document)
        return await self.page_splitter.split(preprocessed)
    
    async def _run_ocr(self, pages: List[Dict]) -> List[Dict]:
        """Run OCR on all pages using appropriate engine."""
        ocr_engine = self.ocr_factory.get_engine(pages)
        return await ocr_engine.process_batch(pages)
    
    async def _classify_document(
        self,
        ocr_results: List[Dict],
        hints: Optional[Dict]
    ) -> tuple:
        """Classify document type."""
        result = await self.document_classifier.classify(ocr_results, hints)
        return result["document_type"], result["confidence"]
    
    async def _extract_fields(
        self,
        ocr_results: List[Dict],
        doc_type: str,
        operation_code: str
    ) -> tuple:
        """Extract fields based on document type schema."""
        schema = self.field_extractor.get_schema(doc_type, operation_code)
        result = await self.field_extractor.extract(ocr_results, schema)
        return result["fields"], result["confidence"]
    
    async def _detect_signatures(self, pages: List[Dict]) -> Dict:
        """Detect and extract signature regions."""
        return await self.signature_detector.detect(pages)
    
    def _calculate_overall_confidence(
        self,
        classification_conf: float,
        extraction_conf: float
    ) -> float:
        """Calculate weighted overall confidence score."""
        weights = {"classification": 0.3, "extraction": 0.7}
        return (
            classification_conf * weights["classification"] +
            extraction_conf * weights["extraction"]
        )
    
    def _build_validation_context(self, documents: List[Dict]) -> Dict:
        """Build validation context from all documents."""
        context = {}
        for doc in documents:
            doc_type = doc["type"].lower()
            context[doc_type] = doc["extracted_fields"]
        return context
    
    def _determine_overall_status(self, results: List[Dict]) -> str:
        """Determine overall dossier status based on validation results."""
        has_errors = any(r["status"] == "error" for r in results)
        has_warnings = any(r["status"] == "warning" for r in results)
        
        if has_errors:
            return "requires_review"
        elif has_warnings:
            return "approved_with_warnings"
        else:
            return "approved"
    
    def _calculate_dossier_confidence(
        self,
        documents: List[Dict],
        validation_results: List[Dict]
    ) -> float:
        """Calculate overall dossier confidence score."""
        # Average document confidence
        doc_confidence = sum(
            d.get("confidence_scores", {}).get("overall", 0.5)
            for d in documents
        ) / len(documents) if documents else 0
        
        # Validation success rate
        passed_count = sum(1 for r in validation_results if r["status"] == "passed")
        total_count = len(validation_results) if validation_results else 1
        validation_rate = passed_count / total_count
        
        # Weighted combination
        return doc_confidence * 0.6 + validation_rate * 0.4
```

### 5.4 Rule Engine Implementation

```python
# rule_engine/evaluator.py

from typing import Dict, List, Any, Optional
from dataclasses import dataclass
import re
from datetime import datetime, timedelta
from difflib import SequenceMatcher

from rule_engine.parser import RuleParser
from rule_engine.functions import BUILTIN_FUNCTIONS


@dataclass
class RuleResult:
    rule_id: str
    rule_name: str
    status: str  # "passed", "warning", "error"
    message: str
    details: Optional[Dict] = None


class RuleEvaluator:
    """
    Evaluates validation rules against document context.
    Supports a custom expression language for flexible rule definition.
    """
    
    def __init__(self):
        self.parser = RuleParser()
        self.functions = BUILTIN_FUNCTIONS.copy()
    
    def register_function(self, name: str, func: callable):
        """Register a custom function for use in rules."""
        self.functions[name] = func
    
    def evaluate(self, rule: Dict, context: Dict) -> RuleResult:
        """
        Evaluate a single rule against the provided context.
        
        Args:
            rule: Rule definition with condition expression
            context: Document data context (e.g., {"devis": {...}, "facture": {...}})
        
        Returns:
            RuleResult indicating pass/fail status
        """
        try:
            # Parse the condition expression
            condition = rule["condition_expression"]
            parsed = self.parser.parse(condition)
            
            # Evaluate the condition
            result = self._evaluate_expression(parsed, context)
            
            if result:
                return RuleResult(
                    rule_id=rule["code"],
                    rule_name=rule["name"],
                    status="passed",
                    message=f"Rule {rule['code']} passed"
                )
            else:
                status = "warning" if rule["severity"] == "WARNING" else "error"
                return RuleResult(
                    rule_id=rule["code"],
                    rule_name=rule["name"],
                    status=status,
                    message=self._format_message(rule["error_message_template"], context),
                    details=self._get_failure_details(parsed, context)
                )
                
        except Exception as e:
            return RuleResult(
                rule_id=rule["code"],
                rule_name=rule["name"],
                status="error",
                message=f"Rule evaluation error: {str(e)}",
                details={"exception": str(e)}
            )
    
    def _evaluate_expression(self, parsed: Dict, context: Dict) -> bool:
        """Recursively evaluate a parsed expression."""
        expr_type = parsed["type"]
        
        if expr_type == "comparison":
            left = self._resolve_value(parsed["left"], context)
            right = self._resolve_value(parsed["right"], context)
            return self._compare(left, parsed["operator"], right)
        
        elif expr_type == "logical":
            left_result = self._evaluate_expression(parsed["left"], context)
            if parsed["operator"] == "&&":
                if not left_result:
                    return False
                return self._evaluate_expression(parsed["right"], context)
            elif parsed["operator"] == "||":
                if left_result:
                    return True
                return self._evaluate_expression(parsed["right"], context)
            elif parsed["operator"] == "!":
                return not self._evaluate_expression(parsed["operand"], context)
        
        elif expr_type == "function_call":
            func_name = parsed["function"]
            args = [self._resolve_value(arg, context) for arg in parsed["arguments"]]
            return self.functions[func_name](*args)
        
        elif expr_type == "literal":
            return parsed["value"]
        
        return False
    
    def _resolve_value(self, value_spec: Dict, context: Dict) -> Any:
        """Resolve a value specification to an actual value."""
        if value_spec["type"] == "field_reference":
            # e.g., "devis.prime_cee" -> context["devis"]["prime_cee"]
            path = value_spec["path"].split(".")
            current = context
            for part in path:
                if isinstance(current, dict):
                    current = current.get(part, {}).get("value") if isinstance(current.get(part), dict) else current.get(part)
                else:
                    return None
            return current
        
        elif value_spec["type"] == "literal":
            return value_spec["value"]
        
        elif value_spec["type"] == "function_call":
            func_name = value_spec["function"]
            args = [self._resolve_value(arg, context) for arg in value_spec["arguments"]]
            return self.functions[func_name](*args)
        
        return None
    
    def _compare(self, left: Any, operator: str, right: Any) -> bool:
        """Perform comparison operation."""
        if left is None or right is None:
            return False
        
        # Handle date comparisons
        if isinstance(left, str) and isinstance(right, str):
            left_date = self._try_parse_date(left)
            right_date = self._try_parse_date(right)
            if left_date and right_date:
                left, right = left_date, right_date
        
        operators = {
            "==": lambda a, b: a == b,
            "!=": lambda a, b: a != b,
            "<": lambda a, b: a < b,
            ">": lambda a, b: a > b,
            "<=": lambda a, b: a <= b,
            ">=": lambda a, b: a >= b,
        }
        
        return operators.get(operator, lambda a, b: False)(left, right)
    
    def _try_parse_date(self, value: str) -> Optional[datetime]:
        """Try to parse a string as a date."""
        formats = ["%d/%m/%Y", "%Y-%m-%d", "%d-%m-%Y", "%d.%m.%Y"]
        for fmt in formats:
            try:
                return datetime.strptime(value, fmt)
            except ValueError:
                continue
        return None
    
    def _format_message(self, template: str, context: Dict) -> str:
        """Format error message with context values."""
        def replace_field(match):
            path = match.group(1)
            value = self._resolve_value({"type": "field_reference", "path": path}, context)
            return str(value) if value else f"[{path}]"
        
        return re.sub(r'\{(\w+\.\w+)\}', replace_field, template)
    
    def _get_failure_details(self, parsed: Dict, context: Dict) -> Dict:
        """Get detailed information about why a rule failed."""
        details = {}
        
        if parsed["type"] == "comparison":
            details["left_value"] = self._resolve_value(parsed["left"], context)
            details["right_value"] = self._resolve_value(parsed["right"], context)
            details["operator"] = parsed["operator"]
        
        return details


# Built-in functions
BUILTIN_FUNCTIONS = {
    "similarity": lambda s1, s2: SequenceMatcher(None, str(s1).lower(), str(s2).lower()).ratio() if s1 and s2 else 0,
    
    "date_diff": lambda d1, d2, unit="days": (
        (datetime.strptime(d1, "%d/%m/%Y") - datetime.strptime(d2, "%d/%m/%Y")).days
        if unit == "days" else
        (datetime.strptime(d1, "%d/%m/%Y") - datetime.strptime(d2, "%d/%m/%Y")).days // 30
    ) if d1 and d2 else None,
    
    "exists": lambda field: field is not None and field != "",
    
    "is_empty": lambda field: field is None or field == "",
    
    "matches": lambda field, pattern: bool(re.match(pattern, str(field))) if field else False,
    
    "in_list": lambda value, lst: value in lst if value and lst else False,
    
    "abs": lambda x: abs(x) if x is not None else None,
    
    "today": lambda: datetime.now().strftime("%d/%m/%Y"),
    
    "len": lambda x: len(x) if x else 0,
    
    "lower": lambda x: str(x).lower() if x else "",
    
    "upper": lambda x: str(x).upper() if x else "",
    
    "trim": lambda x: str(x).strip() if x else "",
}
```

---

## Part 6: Accuracy Targets & Quality Assurance

### 6.1 Accuracy Metrics

| Metric | Target | Measurement Method |
|--------|--------|-------------------|
| **Document Classification** | 99.5% | Precision/Recall on test set |
| **Field Extraction** | 97.0% | Character-level accuracy |
| **Date Extraction** | 99.0% | Exact match |
| **Amount Extraction** | 99.5% | Exact match |
| **Name Extraction** | 96.0% | Levenshtein similarity â‰¥0.95 |
| **Address Extraction** | 94.0% | Fuzzy match score |
| **Signature Detection** | 98.0% | Binary classification accuracy |
| **Overall Dossier Accuracy** | 98.9% | End-to-end correct validation |

### 6.2 Confidence Thresholds

| Confidence Level | Threshold | Action |
|-----------------|-----------|--------|
| **High** | â‰¥ 0.95 | Auto-accept, no review needed |
| **Medium** | 0.85 - 0.94 | Flag for quick review |
| **Low** | 0.70 - 0.84 | Requires full manual review |
| **Very Low** | < 0.70 | Reject, request re-upload |

### 6.3 Quality Assurance Process

1. **Training Data Quality**
   - Minimum 10,000 annotated documents per type
   - Expert annotation with double-review
   - Regular annotation audits

2. **Model Evaluation**
   - Weekly model performance reports
   - A/B testing for model updates
   - Holdout test set never used in training

3. **Human Review Sampling**
   - 5% random sampling of auto-approved dossiers
   - 100% review of edge cases
   - Disagreement resolution process

4. **Feedback Loop**
   - Human corrections fed back to training
   - Weekly model retraining cycles
   - Performance degradation alerts

---

## Part 7: Integration Points

### 7.1 External Systems

| System | Integration Type | Purpose |
|--------|-----------------|---------|
| **EMMY** | API | CEE registration verification |
| **RGE Database** | API | Installer qualification verification |
| **SIRET/SIREN** | API (INSEE) | Company verification |
| **Address Validation** | API (BAN) | French address validation |
| **Partner CRM** | API | Installer management |
| **Accounting System** | API | Billing integration |
| **Email Service** | SMTP/API | Notifications |

### 7.2 API Endpoints Summary

```
Authentication:
POST   /api/auth/login
POST   /api/auth/refresh
POST   /api/auth/logout

Dossiers:
GET    /api/dossiers                    # List dossiers with filters
POST   /api/dossiers                    # Create new dossier
GET    /api/dossiers/{id}               # Get dossier details
PUT    /api/dossiers/{id}               # Update dossier
DELETE /api/dossiers/{id}               # Delete dossier
POST   /api/dossiers/{id}/validate      # Trigger validation
POST   /api/dossiers/{id}/approve       # Approve dossier
POST   /api/dossiers/{id}/reject        # Reject dossier

Documents:
POST   /api/documents/upload            # Upload document(s)
GET    /api/documents/{id}              # Get document details
GET    /api/documents/{id}/preview      # Get document preview
PUT    /api/documents/{id}/fields       # Update extracted fields
GET    /api/documents/{id}/ocr          # Get OCR results

Validation:
GET    /api/validation/rules            # List all rules
POST   /api/validation/rules            # Create rule
PUT    /api/validation/rules/{id}       # Update rule
DELETE /api/validation/rules/{id}       # Delete rule
POST   /api/validation/rules/{id}/test  # Test rule with sample data

Operations:
GET    /api/operations                  # List operations
POST   /api/operations                  # Create operation
PUT    /api/operations/{id}             # Update operation
GET    /api/operations/{id}/schema      # Get field schema

Billing:
GET    /api/billing/dossiers            # List billable dossiers
POST   /api/billing/generate/{id}       # Generate invoice
GET    /api/billing/summary/{id}        # Get billing summary

Admin:
GET    /api/admin/stats                 # System statistics
GET    /api/admin/audit-log             # Audit trail
POST   /api/admin/users                 # Create user
PUT    /api/admin/users/{id}            # Update user
```

---

## Part 8: Deployment Architecture

### 8.1 Infrastructure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           KUBERNETES CLUSTER                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                         INGRESS (nginx)                               â”‚  â”‚
â”‚  â”‚                    SSL termination, routing                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                      â”‚                                      â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚              â”‚                       â”‚                       â”‚             â”‚
â”‚              â–¼                       â–¼                       â–¼             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   API Service      â”‚ â”‚  Frontend Service  â”‚ â”‚   WebSocket Service    â”‚ â”‚
â”‚  â”‚   (3 replicas)     â”‚ â”‚   (2 replicas)     â”‚ â”‚   (2 replicas)         â”‚ â”‚
â”‚  â”‚   FastAPI          â”‚ â”‚   Next.js          â”‚ â”‚   Real-time updates    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚              â”‚                                              â”‚              â”‚
â”‚              â–¼                                              â”‚              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚              â”‚
â”‚  â”‚   Redis Cluster    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚  â”‚   (Cache + Queue)  â”‚                                                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚
â”‚              â”‚                                                             â”‚
â”‚              â–¼                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    WORKER POOL (Celery)                            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚   â”‚
â”‚  â”‚  â”‚ OCR Worker   â”‚ â”‚ Validation   â”‚ â”‚ Billing      â”‚               â”‚   â”‚
â”‚  â”‚  â”‚ (GPU-enabled)â”‚ â”‚ Worker       â”‚ â”‚ Worker       â”‚               â”‚   â”‚
â”‚  â”‚  â”‚ (4 replicas) â”‚ â”‚ (3 replicas) â”‚ â”‚ (2 replicas) â”‚               â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚                                      â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚              â”‚                       â”‚                       â”‚             â”‚
â”‚              â–¼                       â–¼                       â–¼             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   PostgreSQL       â”‚ â”‚   MinIO (S3)       â”‚ â”‚   Elasticsearch        â”‚ â”‚
â”‚  â”‚   (HA Cluster)     â”‚ â”‚   Document Storage â”‚ â”‚   Search & Analytics   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 GPU Requirements

| Component | GPU Type | Min VRAM | Quantity |
|-----------|----------|----------|----------|
| OCR/VLM Workers | NVIDIA T4 | 16 GB | 2-4 |
| Model Training | NVIDIA A100 | 40 GB | 1 (on-demand) |

### 8.3 Scaling Guidelines

| Metric | Trigger | Action |
|--------|---------|--------|
| API Response Time > 500ms | Scale API pods | +1 replica |
| Queue Depth > 100 | Scale workers | +1 OCR worker |
| Storage > 80% | Expand MinIO | Add storage node |
| GPU Utilization > 80% | Scale GPU workers | +1 GPU node |

---

## Part 9: Security & Compliance

### 9.1 Data Protection

- All data encrypted at rest (AES-256)
- TLS 1.3 for all communications
- PII masking in logs
- GDPR-compliant data retention (5 years for CEE documents)
- Role-based access control (RBAC)

### 9.2 Audit Trail

Every action is logged:
- Document uploads
- Field modifications
- Validation decisions
- User authentications
- Rule changes
- System configuration changes

### 9.3 Compliance Requirements

- **RGPD**: Personal data handling
- **CEE Regulations**: Document retention for 5+ years
- **PNCEE Requirements**: Audit trail for all dossiers

---

## Part 10: Implementation Roadmap

### Phase 1: Foundation (Weeks 1-4)
- [ ] Infrastructure setup (Kubernetes, databases)
- [ ] API skeleton with authentication
- [ ] Document upload and storage
- [ ] Basic OCR integration (Docling)

### Phase 2: Core Pipeline (Weeks 5-8)
- [ ] Document classification model
- [ ] Field extraction for Devis and Facture
- [ ] Basic validation rules
- [ ] Human validation UI

### Phase 3: Full Document Support (Weeks 9-12)
- [ ] AH extraction (all sections)
- [ ] CDC extraction
- [ ] Signature detection
- [ ] Cross-document validation

### Phase 4: Rule Engine (Weeks 13-16)
- [ ] Rule configuration UI
- [ ] Custom rule expression language
- [ ] Rule testing framework
- [ ] Operation configuration

### Phase 5: Billing & Polish (Weeks 17-20)
- [ ] Billing summary generation
- [ ] Email notifications
- [ ] Dashboard analytics
- [ ] Performance optimization

### Phase 6: Production (Weeks 21-24)
- [ ] Load testing
- [ ] Security audit
- [ ] User training
- [ ] Go-live

---

## Appendix A: Sample Validation Rules

```yaml
# config/rules/date_rules.yaml

rules:
  - code: DATE_001
    name: Engagement Before Intervention
    category: DATE
    severity: ERROR
    auto_reject: true
    applies_to: "*"
    condition: "devis.date_signature <= facture.date_debut_travaux"
    error_message: "La date d'engagement (signature devis) doit Ãªtre antÃ©rieure Ã  la date de dÃ©but des travaux"

  - code: DATE_002
    name: Two Week Minimum Period
    category: DATE
    severity: WARNING
    auto_reject: false
    applies_to:
      - "BAR-TH-*"
      - "BAT-TH-*"
    condition: "date_diff(facture.date_debut_travaux, devis.date_signature, 'days') >= 14"
    error_message: "DÃ©lai infÃ©rieur Ã  14 jours entre engagement et travaux ({devis.date_signature} â†’ {facture.date_debut_travaux})"

  - code: DATE_003
    name: Invoice After Work Completion
    category: DATE
    severity: ERROR
    auto_reject: true
    applies_to: "*"
    condition: "facture.date_facture >= facture.date_fin_travaux"
    error_message: "La date de facture doit Ãªtre postÃ©rieure ou Ã©gale Ã  la date de fin des travaux"

  - code: DATE_004
    name: AH Cadre B After Invoice
    category: DATE
    severity: ERROR
    auto_reject: false
    applies_to: "*"
    condition: "ah.cadre_b_date_signature >= facture.date_facture"
    error_message: "La signature du cadre B de l'AH doit Ãªtre postÃ©rieure Ã  la date de facture"

  - code: DATE_005
    name: CDC Before Devis
    category: DATE
    severity: ERROR
    auto_reject: true
    applies_to: "*"
    condition: "cdc.date_signature <= devis.date_signature"
    error_message: "Le cadre de contribution doit Ãªtre signÃ© avant ou en mÃªme temps que le devis"
```

```yaml
# config/rules/amount_rules.yaml

rules:
  - code: AMOUNT_001
    name: Prime CEE Consistency
    category: AMOUNT
    severity: ERROR
    auto_reject: false
    applies_to: "*"
    condition: |
      devis.prime_cee == cdc.prime_montant &&
      devis.prime_cee == facture.prime_cee
    error_message: "Le montant de la prime CEE diffÃ¨re entre les documents (Devis: {devis.prime_cee}â‚¬, CDC: {cdc.prime_montant}â‚¬, Facture: {facture.prime_cee}â‚¬)"

  - code: AMOUNT_002
    name: Prime Deducted from Total
    category: AMOUNT
    severity: ERROR
    auto_reject: false
    applies_to: "*"
    condition: "abs(facture.montant_ttc - facture.prime_cee - facture.reste_a_payer) <= 1"
    error_message: "La prime CEE n'a pas Ã©tÃ© correctement dÃ©duite du montant TTC"

  - code: AMOUNT_003
    name: Positive Prime Amount
    category: AMOUNT
    severity: ERROR
    auto_reject: true
    applies_to: "*"
    condition: "devis.prime_cee > 0"
    error_message: "Le montant de la prime CEE doit Ãªtre positif"
```

```yaml
# config/rules/cross_doc_rules.yaml

rules:
  - code: CROSS_001
    name: Beneficiary Name Consistency
    category: CROSS_DOC
    severity: ERROR
    auto_reject: false
    applies_to: "*"
    condition: |
      similarity(devis.beneficiaire_nom, ah.beneficiaire_nom) >= 0.95 &&
      similarity(devis.beneficiaire_nom, facture.client_nom) >= 0.95
    error_message: "Le nom du bÃ©nÃ©ficiaire n'est pas cohÃ©rent entre les documents"

  - code: CROSS_002
    name: Work Address Consistency
    category: CROSS_DOC
    severity: ERROR
    auto_reject: false
    applies_to: "*"
    condition: |
      similarity(devis.adresse_travaux, ah.adresse_travaux) >= 0.90 &&
      similarity(devis.adresse_travaux, facture.adresse_travaux) >= 0.90
    error_message: "L'adresse des travaux n'est pas cohÃ©rente entre les documents"

  - code: CROSS_003
    name: Surface Consistency
    category: CROSS_DOC
    severity: WARNING
    auto_reject: false
    applies_to: "*"
    condition: "abs(devis.surface_chauffee - ah.surface_chauffee) <= 5"
    error_message: "La surface chauffÃ©e dÃ©clarÃ©e diffÃ¨re entre le devis ({devis.surface_chauffee}mÂ²) et l'AH ({ah.surface_chauffee}mÂ²)"

  - code: CROSS_004
    name: Operation Code Match
    category: CROSS_DOC
    severity: ERROR
    auto_reject: true
    applies_to: "*"
    condition: |
      devis.operation_cee_code == facture.operation_cee_code &&
      devis.operation_cee_code == ah.operation_cee_code
    error_message: "Le code opÃ©ration CEE ne correspond pas entre les documents"

  - code: CROSS_005
    name: Equipment Match
    category: CROSS_DOC
    severity: ERROR
    auto_reject: false
    applies_to: "*"
    condition: |
      similarity(devis.marque_equipement, facture.marque_equipement) >= 0.90 &&
      similarity(devis.modele_equipement, facture.modele_equipement) >= 0.90
    error_message: "La marque/modÃ¨le de l'Ã©quipement diffÃ¨re entre le devis et la facture"
```

---

## Appendix B: Glossary

| Term | Definition |
|------|------------|
| **CEE** | Certificats d'Ã‰conomies d'Ã‰nergie - Energy Savings Certificates |
| **kWh cumac** | Kilowatt-hours cumulated and discounted over equipment lifetime |
| **PNCEE** | PÃ´le National des CEE - National CEE Authority |
| **EMMY** | National registry for CEE |
| **RGE** | Reconnu Garant de l'Environnement - Environmental Quality Label |
| **AH** | Attestation sur l'Honneur - Sworn Statement |
| **CDC** | Cadre de Contribution - Contribution Framework |
| **ObligÃ©** | Energy supplier required to collect CEE |
| **Mandataire** | Authorized intermediary (like Valoren) |
| **Coup de Pouce** | Enhanced subsidy program for certain operations |
| **PrÃ©caritÃ©** | Income-based eligibility tier (Classique, Modeste, TrÃ¨s Modeste) |

---

*End of Document*
